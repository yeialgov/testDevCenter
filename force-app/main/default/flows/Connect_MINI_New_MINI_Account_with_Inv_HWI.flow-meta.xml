<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <name>Notify_CRM</name>
        <label>Notify CRM</label>
        <locationX>446</locationX>
        <locationY>1511</locationY>
        <actionName>Account.MINI_Account_with_yearly_license_has_been_created</actionName>
        <actionType>emailAlert</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>SObjectRowId</name>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputParameters>
        <nameSegment>Account.MINI_Account_with_yearly_license_has_been_created</nameSegment>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <apiVersion>50.0</apiVersion>
    <decisions>
        <description>check if a IHWI exists and also if it is newer than any existing Hardware fulfilment</description>
        <name>Lasted_Serial_number_is_on_OB_INV</name>
        <label>Lasted Serial number is on OB INV</label>
        <locationX>578</locationX>
        <locationY>575</locationY>
        <defaultConnector>
            <targetReference>Set_Admin_Flag_field_0_0_0</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Yes</defaultConnectorLabel>
        <rules>
            <name>no_HW_found</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Get_HWF.Id</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>Get_Invoice_Hardware_Item.Id</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Set_Admin_Flag_field_0_0_0_0</targetReference>
            </connector>
            <label>no HW found</label>
        </rules>
        <rules>
            <name>only_HWF_found</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Get_Invoice_Hardware_Item.Id</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>Get_HWF.Id</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Set_Admin_Flag_field_0</targetReference>
            </connector>
            <label>only HWF found</label>
        </rules>
        <rules>
            <name>Double_Reg</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Get_HWF.Id</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>Get_HWF.CreatedDate</leftValueReference>
                <operator>GreaterThan</operator>
                <rightValue>
                    <elementReference>Get_Invoice_Hardware_Item.CreatedDate</elementReference>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>Get_HWF.Account__r.Related_OB_Invoice__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>Get_Invoice_Hardware_Item.OB_Invoice__c</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Set_Admin_Flag_field_0_0_0_0_0</targetReference>
            </connector>
            <label>Double Reg</label>
        </rules>
        <rules>
            <name>HWF_is_newer</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Get_HWF.Id</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>Get_HWF.CreatedDate</leftValueReference>
                <operator>GreaterThan</operator>
                <rightValue>
                    <elementReference>Get_Invoice_Hardware_Item.CreatedDate</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Set_Admin_Flag_field_0_0</targetReference>
            </connector>
            <label>HWF is newer</label>
        </rules>
    </decisions>
    <decisions>
        <name>MINI_Yearly_License_SLI_exists</name>
        <label>MINI Yearly License SLI exists</label>
        <locationX>578</locationX>
        <locationY>1391</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Yes</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Get_SLI_through_Parent_Acc.Id</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Notify_CRM</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <description>Connect MINI Account with OB Invoice via Serial number CDS-3018, CDS-3122, CRMT-3295, CRMT-3291</description>
    <formulas>
        <name>Double_Reg_msg</name>
        <dataType>String</dataType>
        <expression>&quot;This Account is a double registration of the Customer &quot; + {!Get_HWF.Account__r.CustomerID__c} + &quot; // &quot; + {!$Record.Description}</expression>
    </formulas>
    <formulas>
        <name>HWF_is_newer_msg</name>
        <dataType>String</dataType>
        <expression>&quot;The most recent use of the Serial Number of this MINI has been as Hardware for Customer &quot; + {!Get_HWF.Account__r.CustomerID__c} + &quot; // &quot; + {!$Record.Description}</expression>
    </formulas>
    <formulas>
        <name>No_HW_Found_msg</name>
        <dataType>String</dataType>
        <expression>&quot;No Hardware with the Serial Number of this MINI has been found in the system // &quot; + {!$Record.Description}</expression>
    </formulas>
    <formulas>
        <name>OB_Inv_found_msg</name>
        <dataType>String</dataType>
        <expression>&quot;Related OB Invoice record is &quot; + {!Get_Invoice_Hardware_Item.OB_Invoice__r.Name} + &quot; // &quot; + {!$Record.Description}</expression>
    </formulas>
    <formulas>
        <name>only_HWF_found_msg</name>
        <dataType>String</dataType>
        <expression>&quot;The Serial Number of this MINI,  has previously been registered as Hardware for Customer &quot; + {!Get_HWF.Account__r.CustomerID__c} + &quot; // &quot; + {!$Record.Description}</expression>
    </formulas>
    <interviewLabel>Connect MINI {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Connect MINI New MINI Account with Inv HWI FINAL TEST</label>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordCreates>
        <description>Create a new proper Hardware Fulfilment Record based of the found Invoice Hardware Fulfilment on the MINI Account</description>
        <name>Create_HWF_on_MINI_Account</name>
        <label>Create HWF on MINI Account</label>
        <locationX>1106</locationX>
        <locationY>935</locationY>
        <inputAssignments>
            <field>Account__c</field>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>ArticleName__c</field>
            <value>
                <elementReference>Get_Invoice_Hardware_Item.Article_Name__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>DateShipping__c</field>
            <value>
                <elementReference>Get_Invoice_Hardware_Item.Date_Shipping__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>From_Invoice_Hardware_Item__c</field>
            <value>
                <elementReference>Get_Invoice_Hardware_Item.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>InternalIDHW__c</field>
            <value>
                <elementReference>Get_Invoice_Hardware_Item.InternalIDHW__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>InternalIDSalesOrder__c</field>
            <value>
                <elementReference>Get_Invoice_Hardware_Item.OB_Invoice__r.NetsuiteSOID__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Item_ID__c</field>
            <value>
                <elementReference>Get_Invoice_Hardware_Item.Item_ID__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Name</field>
            <value>
                <elementReference>Get_Invoice_Hardware_Item.Name</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>NetsuiteURL__c</field>
            <value>
                <elementReference>Get_Invoice_Hardware_Item.NetsuiteURL__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>SerialNumber__c</field>
            <value>
                <elementReference>Get_Invoice_Hardware_Item.SerialNumber__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>StatusShipping__c</field>
            <value>
                <elementReference>Get_Invoice_Hardware_Item.Status_Shipping__c</elementReference>
            </value>
        </inputAssignments>
        <object>HardwareFulfilment__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordCreates>
    <recordLookups>
        <description>Check for regular HWFs with the same Serial Number</description>
        <name>Get_HWF</name>
        <label>Get HWF</label>
        <locationX>578</locationX>
        <locationY>455</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Lasted_Serial_number_is_on_OB_INV</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>SerialNumber__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Serial_Number__c</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>HardwareFulfilment__c</object>
        <sortField>CreatedDate</sortField>
        <sortOrder>Desc</sortOrder>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>Looks for Invoice Hardware Item with the same serial number as the Account</description>
        <name>Get_Invoice_Hardware_Item</name>
        <label>Get Invoice Hardware Item</label>
        <locationX>578</locationX>
        <locationY>335</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Get_HWF</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>SerialNumber__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Serial_Number__c</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Invoice_Hardware_Item__c</object>
        <sortField>CreatedDate</sortField>
        <sortOrder>Desc</sortOrder>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>Look for related SLI with identical Parent Account as HWF</description>
        <name>Get_SLI_through_Parent_Acc</name>
        <label>Get SLI through Parent Acc</label>
        <locationX>578</locationX>
        <locationY>1271</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>MINI_Yearly_License_SLI_exists</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Account__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Get_HWF.Account__c</elementReference>
            </value>
        </filters>
        <filters>
            <field>ProductName__c</field>
            <operator>Contains</operator>
            <value>
                <stringValue>MINI</stringValue>
            </value>
        </filters>
        <filters>
            <field>ProductName__c</field>
            <operator>Contains</operator>
            <value>
                <stringValue>yearly</stringValue>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>SubscriptionLineItem__c</object>
        <sortField>Account__c</sortField>
        <sortOrder>Asc</sortOrder>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordUpdates>
        <description>Document found connection in description</description>
        <name>Add_note_to_description</name>
        <label>Add note to description</label>
        <locationX>50</locationX>
        <locationY>815</locationY>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Description</field>
            <value>
                <elementReference>No_HW_Found_msg</elementReference>
            </value>
        </inputAssignments>
        <object>Account</object>
    </recordUpdates>
    <recordUpdates>
        <description>Document found connection in description</description>
        <name>Add_note_to_description_0</name>
        <label>Add note to description</label>
        <locationX>314</locationX>
        <locationY>815</locationY>
        <connector>
            <targetReference>Get_SLI_through_Parent_Acc</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Description</field>
            <value>
                <elementReference>only_HWF_found_msg</elementReference>
            </value>
        </inputAssignments>
        <object>Account</object>
    </recordUpdates>
    <recordUpdates>
        <description>Document found connection in description</description>
        <name>Add_note_to_description_0_0</name>
        <label>Add note to description</label>
        <locationX>842</locationX>
        <locationY>815</locationY>
        <connector>
            <targetReference>Get_SLI_through_Parent_Acc</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Description</field>
            <value>
                <elementReference>HWF_is_newer_msg</elementReference>
            </value>
        </inputAssignments>
        <object>Account</object>
    </recordUpdates>
    <recordUpdates>
        <description>Track flow functionality during test phase</description>
        <name>Set_Admin_Flag_field_0</name>
        <label>Set Admin Flag field</label>
        <locationX>314</locationX>
        <locationY>695</locationY>
        <connector>
            <targetReference>Add_note_to_description_0</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Admin_flag_field__c</field>
            <value>
                <stringValue>CDS-3073 TEST only HWF found</stringValue>
            </value>
        </inputAssignments>
        <object>Account</object>
    </recordUpdates>
    <recordUpdates>
        <description>Track flow functionality during test phase</description>
        <name>Set_Admin_Flag_field_0_0</name>
        <label>Set Admin Flag field</label>
        <locationX>842</locationX>
        <locationY>695</locationY>
        <connector>
            <targetReference>Add_note_to_description_0_0</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Admin_flag_field__c</field>
            <value>
                <stringValue>CDS-3073 TEST HWF is newer</stringValue>
            </value>
        </inputAssignments>
        <object>Account</object>
    </recordUpdates>
    <recordUpdates>
        <description>Track flow functionality during test phase</description>
        <name>Set_Admin_Flag_field_0_0_0</name>
        <label>Set Admin Flag field</label>
        <locationX>1106</locationX>
        <locationY>695</locationY>
        <connector>
            <targetReference>Set_Related_OB_Invoice</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Admin_flag_field__c</field>
            <value>
                <stringValue>CDS-3073 TEST Connection successful</stringValue>
            </value>
        </inputAssignments>
        <object>Account</object>
    </recordUpdates>
    <recordUpdates>
        <description>Track flow functionality during test phase</description>
        <name>Set_Admin_Flag_field_0_0_0_0</name>
        <label>Set Admin Flag field</label>
        <locationX>50</locationX>
        <locationY>695</locationY>
        <connector>
            <targetReference>Add_note_to_description</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Admin_flag_field__c</field>
            <value>
                <stringValue>CDS-3073 TEST no HW found</stringValue>
            </value>
        </inputAssignments>
        <object>Account</object>
    </recordUpdates>
    <recordUpdates>
        <description>Track flow functionality during test phase</description>
        <name>Set_Admin_Flag_field_0_0_0_0_0</name>
        <label>Set Admin Flag field</label>
        <locationX>578</locationX>
        <locationY>695</locationY>
        <connector>
            <targetReference>Set_Related_OB_Invoice_0</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Admin_flag_field__c</field>
            <value>
                <stringValue>CDS-3073 TEST Double Reg</stringValue>
            </value>
        </inputAssignments>
        <object>Account</object>
    </recordUpdates>
    <recordUpdates>
        <description>Sets the Lookup field on the MINI Account and adds a note to the description</description>
        <name>Set_Related_OB_Invoice</name>
        <label>Set Related OB Invoice &amp; Description</label>
        <locationX>1106</locationX>
        <locationY>815</locationY>
        <connector>
            <targetReference>Create_HWF_on_MINI_Account</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Description</field>
            <value>
                <elementReference>OB_Inv_found_msg</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Related_OB_Invoice__c</field>
            <value>
                <elementReference>Get_Invoice_Hardware_Item.OB_Invoice__c</elementReference>
            </value>
        </inputAssignments>
        <object>Account</object>
    </recordUpdates>
    <recordUpdates>
        <description>Sets the Lookup field on the MINI Account and adds note to the description</description>
        <name>Set_Related_OB_Invoice_0</name>
        <label>Set Related OB Invoice &amp; Description</label>
        <locationX>578</locationX>
        <locationY>815</locationY>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Description</field>
            <value>
                <elementReference>Double_Reg_msg</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Related_OB_Invoice__c</field>
            <value>
                <elementReference>Get_Invoice_Hardware_Item.OB_Invoice__c</elementReference>
            </value>
        </inputAssignments>
        <object>Account</object>
    </recordUpdates>
    <start>
        <locationX>452</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Get_Invoice_Hardware_Item</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Target_Product__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>MINI</stringValue>
            </value>
        </filters>
        <filters>
            <field>Serial_Number__c</field>
            <operator>NotEqualTo</operator>
            <value>
                <stringValue></stringValue>
            </value>
        </filters>
        <object>Account</object>
        <recordTriggerType>Create</recordTriggerType>
        <triggerType>RecordAfterSave</triggerType>
    </start>
    <status>Obsolete</status>
</Flow>
